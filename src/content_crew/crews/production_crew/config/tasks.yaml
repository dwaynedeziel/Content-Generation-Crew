article_writing_task:
  description: >
    Write a complete, publication-ready article based on this approved content brief:
    
    Topic: {topic_name}
    Primary Keyword: {primary_keyword}
    Secondary Keywords: {secondary_keywords}
    Content Type: {content_type}
    Word Count Target: {word_count_min}-{word_count_max} words
    Search Intent: {search_intent}
    Target Entities: {target_entities}
    Internal Link Targets: {internal_link_targets}
    
    Brief content:
    {brief_content}
    
    ARTICLE STRUCTURE (follow exactly):
    
    ---
    meta_title: "[from brief, max 60 chars, keyword in first 30 chars]"
    meta_description: "[from brief, max 155 chars, compelling]"
    url_slug: "[from brief]"
    primary_keyword: "{primary_keyword}"
    word_count: [actual count]
    date_created: "{date}"
    client: "{client_name}"
    status: "draft"
    ---
    
    # [H1 with primary keyword, different from meta_title]
    
    [Opening paragraph: primary keyword, core definition/answer, inverted pyramid,
    50-80 words, self-contained for RAG extraction]
    
    ## [H2 sections following brief outline]
    [Each H2 is atomic and self-contained, no cross-references]
    
    ### [H3 subsections where needed]
    
    ## [Comparison table section if content type warrants it]
    
    ## Frequently Asked Questions
    ### [Question from brief]
    [40-60 word answer, direct answer first, snippet-optimized]
    
    ## Key Takeaways
    - [5 actionable bullet points summarizing the article]
    
    WRITING RULES:
    - Follow the client's brand voice and the brief's style guidance
    - Active voice, varied sentence length
    - Max 4 sentences per paragraph
    - Inverted pyramid in every section
    - Bold ALL target entities on their FIRST occurrence
    - Internal links formatted as: [anchor text](link-target: Topic Name)
    - Image placeholders: ![descriptive alt text](image-placeholder)
    - Tables for any comparison of 4+ items
    - NEVER use banned phrases (they are listed in your backstory)
    
    Write the article now. Be thorough, detailed, and follow the brief exactly.
  expected_output: >
    A complete markdown article with:
    - YAML frontmatter (meta_title, meta_description, url_slug, primary_keyword, word_count, date_created, client, status)
    - H1 with primary keyword
    - Opening paragraph (50-80 words, inverted pyramid)
    - All H2/H3 sections from the brief outline
    - Comparison table (if applicable)
    - FAQ section with 4-6 questions (40-60 word answers)
    - Key Takeaways (5 bullet points)
    - No banned AI cliché phrases
    - Word count within the specified range
  agent: content_writer

qa_review_task:
  description: >
    Run the full QA protocol on the article written for: "{topic_name}"
    Primary Keyword: {primary_keyword}
    Word Count Range: {word_count_min}-{word_count_max}
    Target Entities: {target_entities}
    Internal Link Targets: {internal_link_targets}
    Secondary Keywords: {secondary_keywords}
    Content Type: {content_type}
    
    Use the banned_phrase_checker tool to scan for banned phrases.
    
    CHECK EVERY ITEM BELOW. For each item, mark PASS ✅ or FAIL ❌.
    
    STRUCTURE & INTENT:
    - [ ] Search intent ({search_intent}) matches content
    - [ ] Inverted pyramid: key answer in first paragraph
    - [ ] All H2 sections atomic and self-contained
    - [ ] Key Takeaways present (exactly 5 items)
    - [ ] FAQ section present (4-6 questions)
    
    SEO & TECHNICAL:
    - [ ] Meta title: present, <60 chars, has "{primary_keyword}"
    - [ ] Meta description: present, <155 chars, compelling, has keyword
    - [ ] URL slug: present, clean, keyword-focused
    - [ ] Primary keyword in H1, first paragraph, and 2+ H2 headings
    - [ ] Secondary keywords distributed: {secondary_keywords}
    - [ ] Internal link placeholders for: {internal_link_targets}
    - [ ] Image alt text on all placeholders
    - [ ] Word count within {word_count_min}-{word_count_max} range
    
    OPTIMIZATION:
    - [ ] Information gain element present
    - [ ] Comparison table (required if content type is "comparison")
    - [ ] FAQ answers 40-60 words, snippet-optimized
    - [ ] Target entities mentioned and bolded: {target_entities}
    - [ ] No banned AI cliché phrases (use banned_phrase_checker tool)
    
    If ANY items FAIL:
    1. Provide specific fix instructions
    2. The article will be rewritten and re-checked (up to 3 total attempts)
    3. After 3 failed attempts on any item, mark it with ⚠️
    
    After all checks pass (or max attempts reached), append the QA report to the article:
    
    ---
    ## QA Report
    
    | Check | Status |
    |-------|--------|
    | [each item] | ✅ PASS or ❌ FAIL or ⚠️ FLAGGED |
    
    **Meta Title:** [X] chars
    **Meta Description:** [X] chars  
    **Word Count:** [X] words
    **Entity Coverage:** [list entities found/missing]
    
    `QA Status: PASSED/FLAGGED | Attempts: N/3 | Date: {date}`
    ---
    
    Use the file_writer tool to save the final article (with QA appendix) to:
    {output_dir}/articles/{topic_name} - {date}.md
  expected_output: >
    The final article with QA report appended, saved to the output directory.
    The report includes pass/fail status for all 17 checklist items, character counts
    for meta tags, word count, entity coverage, and the QA status line.
  agent: qa_editor
